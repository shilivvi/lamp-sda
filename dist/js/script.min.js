var html='<header class="header"><div class="container"><div class="header__wrap"><ul class="header__nav"><li class="header__item" data-menu=\'rgb\'><snap class="header__icon"><svg><use xlink:href="#color"></use></svg></snap><snap class="header__text">RGB</snap></li><li class="header__item" data-menu=\'modes\'><snap class="header__icon"><svg><use xlink:href="#modes"></use></svg></snap><snap class="header__text">Режимы</snap></li><li class="header__item"  data-menu=\'settings\'><snap class="header__icon"><svg><use xlink:href="#settings"></use></svg></snap><snap class="header__text">Настройки</snap></li></ul></div></div></header><section class="rgb active-menu"><div class="container"><div class="rgb__wrap"><div class="rgb__picker picker-rbg"><div id="picker"></div><form class="picker-rbg__form"><div class="picker-rbg__row picker-rbg__row--r"><span class="picker-rbg__text">R: </span><input name="red" type="number" class="picker-rbg__input" min="0" max="255"></div><div class="picker-rbg__row picker-rbg__row--g"><span class="picker-rbg__text">G: </span><input name="green" type="number" class="picker-rbg__input" min="0" max="255"></div><div class="picker-rbg__row picker-rbg__row--b"><span class="picker-rbg__text">B: </span><input name="blue" type="number" class="picker-rbg__input" min="0" max="255"></div></form></div><div class="rgb__sliders sliders-rgb"><div class="sliders-rgb__item"><div class="sliders-rgb__icon sliders-rgb__icon--left"><svg><use xlink:href="#small-sun"></use></svg></div><div class="sliders-rgb__slider"><input class="sliders-rgb__input" id="brightness" type="range" min="1" max="255" value="0" oninput="brightnessSliderChanged(this)" onchange="changeEventBrightnessSlider(this)"></div><div class="sliders-rgb__icon sliders-rgb__icon--right"><svg><use xlink:href="#big-sun"></use></svg></div></div><div class="sliders-rgb__item"><div class="sliders-rgb__icon sliders-rgb__icon--left"><svg><use xlink:href="#slow"></use></svg></div><div class="sliders-rgb__slider"><input class="sliders-rgb__input" id="speed" type="range" min="1" max="65535" value="0" oninput="speedSliderChanged(this)" onchange="changeEventSpeedSlider(this)"></div><div class="sliders-rgb__icon sliders-rgb__icon--right"><svg><use xlink:href="#fast"></use></svg></div></div></div><div id="favorite-colors" class="rgb__colors colors-rgb"><div class="colors-rgb__row"><div class="colors-rgb__item"><span class="colors-rgb__plus">+</span></div><div class="colors-rgb__item"><span class="colors-rgb__plus">+</span></div><div class="colors-rgb__item"><span class="colors-rgb__plus">+</span></div><div class="colors-rgb__item"><span class="colors-rgb__plus">+</span></div><div class="colors-rgb__item"><span class="colors-rgb__plus">+</span></div><div class="colors-rgb__item"><span class="colors-rgb__plus">+</span></div></div></div><div id="favorite-modes" class="rbg__modes modes-rgb"><div class="modes-rgb__row"><button class="modes-rgb__item"><div class="modes-rgb__plus">+</div><div class="modes-rgb__name"></div></button><button class="modes-rgb__item"><div class="modes-rgb__plus">+</div><div class="modes-rgb__name"></div></button><button class="modes-rgb__item"><div class="modes-rgb__plus">+</div><div class="modes-rgb__name"></div></button><button class="modes-rgb__item"><div class="modes-rgb__plus">+</div><div class="modes-rgb__name"></div></button></div></div></div></div><div class="power-btn on"><button class="power-btn__btn"><svg class=\'power-btn__svg power-btn__on\'><use xlink:href="#led on"></use></svg><svg class=\'power-btn__svg power-btn__off\'><use xlink:href="#led off"></use></svg></button></div></section><section class="modes"><div class="container"><div class="modes__wrap"></div></div></section><div class="favorite-popup"><div class="favorite-popup__wrap"><div class="favorite-popup__content"><div class="favorite-popup__row"><div class="favorite-popup__icon"></div><div class="favorite-popup__text">Удалить</div></div></div></div></div><template id="modes-item"><div class="modes__item"><div class="modes__name"></div></div></template>';let colorPicker="",curMode="",allModes="",defaultColor="#f00",defaultSpeed=32765,defaultBr=150;function setDefaultSettings(){colorPicker=new iro.ColorPicker("#picker",{width:330,color:{r:defaultColor[0],g:defaultColor[1],b:defaultColor[2],alpha:1}}),colorPicker.on("input:end",(function(e){const s=e.rgb;submitVal("c",65536*s.r+256*s.g+s.b),displayCurColor(65536*s.r+256*s.g+s.b)})),colorPicker.on("input:change",(function(e){setRGBForm(colorPicker.color.rgb)})),setRGBForm(colorPicker.color.rgb),initEventRGBForm();const e=document.querySelector("#brightness");e.value=parseInt(defaultBr);const s=e.value;e.style.background=`linear-gradient(to right, #1083ff, #1083ff ${s/2.55}%, #ccc ${s/2.55}%)`;const t=document.querySelector("#speed");t.value=parseInt(defaultSpeed);const r=t.value;t.style.background=`linear-gradient(to right, #1083ff, #1083ff ${r/655.35}%, #ccc ${r/655.35}%)`}function initHeaderNav(){document.querySelectorAll(".header__item").forEach((e=>{e.addEventListener("click",(s=>{s.preventDefault(),e.hasAttribute("data-menu")&&("settings"==e.dataset.menu&&window.open("/_ac","_self"),document.querySelectorAll(".active-menu").forEach((e=>e.classList.remove("active-menu"))),document.querySelector(`.${e.dataset.menu}`).classList.add("active-menu"))}))}))}function initRowDefaultColors(e){const s=document.querySelectorAll("#favorite-colors .colors-rgb__item");e.forEach(((e,t)=>{if("0"!=e){const r=decToRgb(parseInt(e,10)),o=s[t];o.style.background=`rgb(${r[0]}, ${r[1]}, ${r[2]})`,o.classList.add("colors-rgb__item--set"),o.dataset.color=e}})),s.forEach(((e,s)=>{longPressEvent(e,(()=>{if(e.hasAttribute("data-color")){const s=e.dataset.color,t=decToRgb(parseInt(s,10));submitVal("c",s),colorPicker.color.rgb={r:t[0],g:t[1],b:t[2]},setRGBForm({r:t[0],g:t[1],b:t[2]}),displayCurColor(s)}else{const t=colorPicker.color.rgb;e.style.background=`rgb(${t.r}, ${t.g}, ${t.b})`,e.classList.add("colors-rgb__item--set"),e.dataset.color=65536*t.r+256*t.g+t.b,submitVal(`fc${s+1}`,e.dataset.color)}}),(()=>{if(e.hasAttribute("data-color")){const e=document.querySelector(".favorite-popup");e.dataset.row="color",e.dataset.col=s,e.classList.add("favorite-popup--active")}else{const t=colorPicker.color.rgb;e.style.background=`rgb(${t.r}, ${t.g}, ${t.b})`,e.classList.add("colors-rgb__item--set"),e.dataset.color=65536*t.r+256*t.g+t.b,submitVal(`fc${s+1}`,e.dataset.color)}}))}))}function initRowDefaultModes(e){const s=document.querySelectorAll("#favorite-modes .modes-rgb__item");e.forEach(((e,t)=>{if("?"!=e&&e<allModes.length){const r=s[t];r.querySelector(".modes-rgb__name").innerHTML=allModes[e],r.dataset.mode=e,r.classList.add("modes-rgb__item--set")}})),s.forEach(((e,s)=>{longPressEvent(e,(()=>{if(e.hasAttribute("data-mode")){const s=e.dataset.mode;curMode=s,submitVal("m",s),displayCurMode()}else""!=curMode&&(e.dataset.mode=curMode,e.querySelector(".modes-rgb__name").innerHTML=allModes[curMode],e.classList.add("modes-rgb__item--set"),submitVal(`fm${s+1}`,curMode))}),(()=>{if(e.hasAttribute("data-mode")){const e=document.querySelector(".favorite-popup");e.dataset.row="mode",e.dataset.col=s,e.classList.add("favorite-popup--active")}else""!=curMode&&(e.dataset.mode=curMode,e.querySelector(".modes-rgb__name").innerHTML=allModes[curMode],e.classList.add("modes-rgb__item--set"),submitVal(`fm${s+1}`,curMode))}))}))}function initFavoritePopup(){const e=document.querySelector(".favorite-popup"),s=document.querySelector(".favorite-popup__wrap"),t=e.querySelector(".favorite-popup__row"),r=()=>{e.removeAttribute("data-row"),e.removeAttribute("data-col"),e.classList.remove("favorite-popup--active")};s.addEventListener("click",r),t.addEventListener("click",(s=>{s.stopPropagation();const t=e.dataset.row,o=e.dataset.col;if("color"==t){const e=document.querySelectorAll("#favorite-colors .colors-rgb__item")[o];e.style.background="",e.classList.remove("colors-rgb__item--set"),e.removeAttribute("data-color"),submitVal(`fc${parseInt(o)+1}`,"000000")}if("mode"==t){const e=document.querySelectorAll("#favorite-modes .modes-rgb__item")[o];e.classList.remove("modes-rgb__item--set"),e.removeAttribute("data-mode"),submitVal(`fm${parseInt(o)+1}`,"?")}r()}))}function initPowerBtn(e){const s=document.querySelector(".power-btn");1==parseInt(e)&&(s.classList.toggle("on"),s.dataset.on="on"),s.addEventListener("click",(()=>{s.classList.toggle("on"),s.hasAttribute("data-on")?(s.removeAttribute("data-on"),submitVal("stat","0")):(s.dataset.on="on",submitVal("stat","1"))}))}function initModesPage(){const e=document.querySelector(".modes__wrap"),s=document.querySelector("#modes-item");allModes.forEach(((t,r)=>{if(""!=t){const o=s.content.cloneNode(!0);o.querySelector(".modes__item").dataset.mode=r,o.querySelector(".modes__name").innerHTML=t,e.append(o)}})),document.querySelectorAll(".modes .modes__item").forEach((e=>{e.addEventListener("click",(s=>{if(s.preventDefault(),e.hasAttribute("data-mode")){const s=e.dataset.mode;curMode=s,submitVal("m",s)}displayCurMode()}))})),displayCurMode()}function brightnessSliderChanged(e){let s=e.value;e.style.background=`linear-gradient(to right, #1083ff, #1083ff ${s/2.55}%, #ccc ${s/2.55}%)`}function changeEventBrightnessSlider(e){submitVal("b",e.value)}function speedSliderChanged(e){let s=e.value;e.style.background=`linear-gradient(to right, #1083ff, #1083ff ${s/655.35}%, #ccc ${s/655.35}%)`}function changeEventSpeedSlider(e){const s=e.max-e.value;s<=0?submitVal("s",1):s>=e.max?submitVal("s",e.max):submitVal("s",s)}function setRGBForm(e){const s=document.querySelector('.picker-rbg__form input[name="red"]'),t=document.querySelector('.picker-rbg__form input[name="green"]'),r=document.querySelector('.picker-rbg__form input[name="blue"]');s.value=e.r,t.value=e.g,r.value=e.b}function initEventRGBForm(){document.querySelectorAll(".picker-rbg__form input").forEach((e=>{e.addEventListener("change",(()=>{const s=e.value;(s<0||""==s)&&(e.value=0),s>255&&(e.value=255);const t=parseInt(document.querySelector('.picker-rbg__form input[name="red"]').value),r=parseInt(document.querySelector('.picker-rbg__form input[name="green"]').value),o=parseInt(document.querySelector('.picker-rbg__form input[name="blue"]').value),i=65536*t+256*r+o;colorPicker.color.rgb={r:t,g:r,b:o},submitVal("c",i),displayCurColor(i)}))}))}function displayCurMode(){const e=document.querySelectorAll(`[data-mode="${curMode}"]`);e.length<=0||(document.querySelectorAll(".cur-mode").forEach((e=>e.classList.remove("cur-mode"))),e.forEach((e=>e.classList.add("cur-mode"))))}function displayCurColor(e){const s=document.querySelector(`[data-color="${e}"]`);null!=s&&(document.querySelectorAll(".cur-color").forEach((e=>e.classList.remove("cur-color"))),s.classList.add("cur-color"))}function longPressEvent(e,s,t){let r=!1,o=null,i=function(e){null!==o&&(clearTimeout(o),o=null)},a=function(e){if("click"!==e.type||0===e.button)return r=!1,null===o&&(o=setTimeout((function(){t(),r=!0}),500)),!1};e.addEventListener("mousedown",a),e.addEventListener("touchstart",a),e.addEventListener("click",(function(e){if(null!==o&&(clearTimeout(o),o=null),r)return!1;s()})),e.addEventListener("mouseout",i),e.addEventListener("touchend",i),e.addEventListener("touchleave",i),e.addEventListener("touchcancel",i)}function sendRequest(e,s,t=null){return new Promise(((r,o)=>{const i=new XMLHttpRequest;i.onload=()=>{i.status>=400?o(i.response):(console.log(i.response),isJson(i.response)?r(JSON.parse(data)):r(i.response))},i.onerror=()=>{o(i.response)},i.open(e,s),i.send(JSON.stringify(t))}))}function getVal(e){return new Promise(((s,t)=>{sendRequest("GET",e).then((e=>s(e))).catch((e=>s(e)))}))}function submitVal(e,s){sendRequest("GET",`set?${e}=${s}`)}function getSvgSprite(e){const s=new XMLHttpRequest;s.open("GET",e,!0),s.send(),s.onload=function(e){const t=document.createElement("div");t.classList.add("svg-sprite"),t.innerHTML=s.responseText,document.body.insertBefore(t,document.body.childNodes[0])}}function isJson(e){try{JSON.parse(e)}catch(e){return!1}return!0}function decToRgb(e){return[Math.floor(e/65536),Math.floor(e/256)%256,e%256]}window.addEventListener("DOMContentLoaded",(()=>{getSvgSprite("https://rawcdn.githack.com/shilivvi/lamp-sda/28efb2db2ad72b1e99b65d345cdde79fb99e41f9/dist/img/sprite.svg"),document.querySelector("body").insertAdjacentHTML("afterbegin",html),getVal("defaults").then((e=>{const s=e.split(";");defaultColor=decToRgb(parseInt(s[0],10)),defaultSpeed=s[1],defaultBr=s[2],curMode=parseInt(s[3]),initRowDefaultColors(s[5].split(",")),initPowerBtn(s[6]),setDefaultSettings(),displayCurColor(parseInt(s[0],10)),initHeaderNav(),initFavoritePopup(),getVal("modes").then((e=>{allModes=e.split(","),initRowDefaultModes(s[4].split(",")),initModesPage()}))}))}));
